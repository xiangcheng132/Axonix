-- 用户表
CREATE TABLE IF NOT EXISTS user (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    avatar VARCHAR(255) COMMENT '头像',
    gender INT COMMENT '性别（0: 未知, 1: 男, 2: 女）',
    age INT COMMENT '年龄',
    province VARCHAR(50) COMMENT '省',
    city VARCHAR(50) COMMENT '市',
    county VARCHAR(50) COMMENT '县',
    address VARCHAR(255) COMMENT '详细地址',
    email VARCHAR(100) COMMENT '邮箱',
    phone VARCHAR(20) COMMENT '手机号',
    disability_type INT COMMENT '残障类型（0: 无, 1: 视障, 2: 听障, 3: 其他障碍）',
    last_login_time DATETIME COMMENT '最后登录时间',
    is_vip INT DEFAULT 0 COMMENT '是否VIP（0: 否, 1: 是）',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
);

-- VIP表
CREATE TABLE IF NOT EXISTS vip (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'VIP记录ID',
    user_id INT NOT NULL COMMENT '用户ID',
	levels INT COMMENT 'Vip等级',
    start_time DATETIME COMMENT '开通时间',
    end_time DATETIME COMMENT '截止时间',
    total_payment DECIMAL(10, 2) COMMENT '累计支付金额',
    FOREIGN KEY (user_id) REFERENCES user(id)
);

-- 管理员表
CREATE TABLE IF NOT EXISTS admin (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '管理员ID',
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    phone VARCHAR(20) COMMENT '手机号',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
);

-- 紧急联系人表
CREATE TABLE IF NOT EXISTS emergency_contact (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '紧急联系人记录ID',
    user_id INT NOT NULL COMMENT '用户ID',
    contact_user_id INT NOT NULL COMMENT '紧急联系人ID',
    contact_phone VARCHAR(20) COMMENT '紧急联系人手机号',
    relationship VARCHAR(50) COMMENT '关系',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (user_id) REFERENCES user(id),
    FOREIGN KEY (contact_user_id) REFERENCES user(id)
);

-- 求助表
CREATE TABLE IF NOT EXISTS help_request (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '求助记录ID',
    requester_id INT NOT NULL COMMENT '求助者ID',
    helper_id INT COMMENT '帮助者ID',
    requester_lng DECIMAL(10, 6) COMMENT '求助者经度',
    requester_lat DECIMAL(10, 6) COMMENT '求助者纬度',
    helper_lng DECIMAL(10, 6) COMMENT '帮助者经度',
    helper_lat DECIMAL(10, 6) COMMENT '帮助者纬度',
    status INT COMMENT '状态（0: 正在发布, 1: 匹配中, 2: 处理中, 3: 完成, 4: 特殊情况）',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (requester_id) REFERENCES user(id),
    FOREIGN KEY (helper_id) REFERENCES emergency_contact(id)
);

-- 通知表
CREATE TABLE IF NOT EXISTS notification (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '通知ID',
    admin_id INT NOT NULL COMMENT '管理员ID',
    title VARCHAR(100) COMMENT '标题',
    content TEXT COMMENT '内容',
    target_type INT COMMENT '发布对象（0: 全部, 1: 视障, 2: 听障, 3: 其他障碍）',
    send_time DATETIME COMMENT '发送时间',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (admin_id) REFERENCES admin(id)
);

-- 紧急SOS通知表
CREATE TABLE IF NOT EXISTS sos_notification (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'SOS通知ID',
    user_id INT NOT NULL COMMENT '用户ID',
    title VARCHAR(100) COMMENT '标题',
    content TEXT COMMENT '内容',
    contact_id INT NOT NULL COMMENT '紧急联系人ID',
    lng DECIMAL(10, 6) COMMENT '经度',
    lat DECIMAL(10, 6) COMMENT '纬度',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (user_id) REFERENCES user(id),
    FOREIGN KEY (contact_id) REFERENCES emergency_contact(id)
);

-- 路况识别日志表
CREATE TABLE IF NOT EXISTS traffic_log (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '日志ID',
    user_id INT NOT NULL COMMENT '用户ID',
    last_lng DECIMAL(10, 6) COMMENT '最后经度',
    last_lat DECIMAL(10, 6) COMMENT '最后纬度',
    start_time DATETIME COMMENT '开始使用时间',
    end_time DATETIME COMMENT '结束时间',
    FOREIGN KEY (user_id) REFERENCES user(id)
);

-- AI助理日志表
CREATE TABLE IF NOT EXISTS ai_log (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '日志ID',
    user_id INT NOT NULL COMMENT '用户ID',
    start_time DATETIME COMMENT '开始使用时间',
    FOREIGN KEY (user_id) REFERENCES user(id)
);

-- 论坛帖子表
CREATE TABLE IF NOT EXISTS forum_post (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '帖子ID',
    user_id INT NOT NULL COMMENT '用户ID',
    title VARCHAR(100) COMMENT '标题',
    content TEXT COMMENT '内容',
    status INT COMMENT '状态（0: 审核中, 1: 驳回, 2: 异常, 3: 已发布, 4: 私密）',
    likes INT DEFAULT 0 COMMENT '喜欢数',
    dislikes INT DEFAULT 0 COMMENT '不喜欢数',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (user_id) REFERENCES user(id)
);

-- 论坛评论表
CREATE TABLE IF NOT EXISTS forum_comment (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '评论ID',
    user_id INT NOT NULL COMMENT '用户ID',
    post_id INT NOT NULL COMMENT '帖子ID',
    content TEXT COMMENT '内容',
    status INT COMMENT '状态（0: 审核中, 1: 驳回, 2: 异常, 3: 已发布, 4: 私密）',
    likes INT DEFAULT 0 COMMENT '喜欢数',
    dislikes INT DEFAULT 0 COMMENT '不喜欢数',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (user_id) REFERENCES user(id),
    FOREIGN KEY (post_id) REFERENCES forum_post(id)
);

-- 功能使用统计表
CREATE TABLE IF NOT EXISTS function_stat (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '统计ID',
    user_id INT NOT NULL COMMENT '用户ID',
    help_request INT DEFAULT 0 COMMENT '求助匹配次数',
    help_match INT DEFAULT 0 COMMENT '帮助匹配次数',
    help_request_success INT DEFAULT 0 COMMENT '求助匹配成功次数',
    help_match_success INT DEFAULT 0 COMMENT '帮助匹配成功次数',
    navigation INT DEFAULT 0 COMMENT '导航使用次数',
    traffic_recognition INT DEFAULT 0 COMMENT '路况识别次数',
    ai_assistant INT DEFAULT 0 COMMENT 'AI助理使用次数',
    emergency_contact INT DEFAULT 0 COMMENT '联系紧急联系人次数',
    post_publish INT DEFAULT 0 COMMENT '论坛帖子发布次数',
    comment INT DEFAULT 0 COMMENT '评论次数',
    feedback INT DEFAULT 0 COMMENT '问题反馈次数',
    sos INT DEFAULT 0 COMMENT '紧急SOS次数',
    FOREIGN KEY (user_id) REFERENCES user(id)
);

-- 反馈表
CREATE TABLE IF NOT EXISTS feedback (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '反馈ID',
    user_id INT NOT NULL COMMENT '用户ID',
    issue TEXT COMMENT '反馈问题',
    status INT COMMENT '状态（0: 用户提交, 1: 处理中, 2: 已完成, 3: 异常）',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (user_id) REFERENCES user(id)
);